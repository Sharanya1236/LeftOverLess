{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Food | LeftOverLess</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="{% static 'css/main.css' %}">

<style>
/* Page specific fixes only */
body{
  min-height:100vh;
  margin:0;
  font-family:'Segoe UI', system-ui, sans-serif;
  background: linear-gradient(135deg, #134e5e, #71b280);
  color:#fff;
}
.form-card{
  max-width: 650px;
  margin: auto;
}

.form-group{
  margin-bottom: 16px;
}

.form-row{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

input, select, textarea{
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  outline: none;
  font-size: 14px;
}

textarea{
  resize: none;
  height: 80px;
}

label{
  font-size: 14px;
  font-weight: 600;
  display: block;
  margin-bottom: 6px;
}

#map{
  height: 260px;
  border-radius: 14px;
  margin-top: 10px;
}

.actions{
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

.actions button,
.actions a{
  flex: 1;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">

  <h2 align="center">üç± Add Food Donation</h2>
  <p align ="center">Donate surplus food before it expires</p>

  {% if messages %}
    {% for message in messages %}
      <div class="alert {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div class="card form-card">

    <form method="post">
      {% csrf_token %}

      <div class="form-group">
        <label>Food Name</label>
        <input type="text" name="food_name" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Food Type</label>
          <select name="food_type" required>
            <option value="">Select</option>
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
          </select>
        </div>

        <div class="form-group">
          <label>Quantity (people)</label>
          <input type="number" name="quantity" min="1" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Prepared Time</label>
          <input type="datetime-local" name="prepared_time" required>
        </div>

        <div class="form-group">
          <label>Expiry Time</label>
          <input type="datetime-local" name="expiry_time" required>
        </div>
      </div>

      <div class="form-group">
        <label>Pickup Address</label>
        <textarea name="address" required></textarea>
      </div>

      <div class="form-group">
        <label>Pickup Location</label>
        <div id="map"></div>
      </div>

      <input type="hidden" name="latitude" id="lat">
      <input type="hidden" name="longitude" id="lng">

      <div class="form-group">
        <label>Notes (optional)</label>
        <textarea name="notes"></textarea>
      </div>

      <div class="actions">
        <button type="submit" class="btn btn-primary">Post Food</button>
        <a href="{% url 'donor_dashboard' %}" class="btn btn-danger">Back</a>
      </div>

    </form>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map, marker;

function initMap(lat, lng){
  map = L.map('map').setView([lat, lng], 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  }).addTo(map);

  marker = L.marker([lat, lng], { draggable:true }).addTo(map);

  updateCoords(lat, lng);

  marker.on('dragend', function(){
    const pos = marker.getLatLng();
    updateCoords(pos.lat, pos.lng);
  });
}

function updateCoords(lat, lng){
  document.getElementById('lat').value = lat;
  document.getElementById('lng').value = lng;
}

navigator.geolocation.getCurrentPosition(
  (pos) => initMap(pos.coords.latitude, pos.coords.longitude),
  () => initMap(17.3850, 78.4867) // fallback Hyderabad
);
</script>

</body>
</html>
